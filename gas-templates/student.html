<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌈 마음날씨 일기</title>
  <?!= include('styles'); ?>
</head>
<body>
  <div class="container">
    <header>
      <h1>🌈 마음날씨 일기</h1>
      <p class="subtitle">오늘 나의 마음은 어떤 날씨일까요?</p>
    </header>

    <!-- 학생 정보 -->
    <div class="card">
      <h2>📝 내 정보</h2>
      <div class="form-group">
        <label for="studentName">이름</label>
        <input type="text" id="studentName" placeholder="홍길동">
      </div>
      <div class="form-group">
        <label for="studentClass">학반 (여러 형태로 입력 가능)</label>
        <input type="text" id="studentClass" placeholder="3-1 또는 3학년 1반 또는 3-1-15">
        <small class="input-help">💡 예시: 3-1, 3학년 1반, 3-1-15 등 자유롭게 입력하세요</small>
      </div>
    </div>

    <!-- 날짜 선택 -->
    <div class="card">
      <h2>📅 날짜</h2>
      <div class="form-group">
        <input type="date" id="diaryDate" class="date-input">
      </div>
    </div>

    <!-- 감정 선택 -->
    <div class="card">
      <h2>🎨 오늘의 마음 날씨</h2>
      <div class="emotion-grid">
        <div class="emotion-item" data-emotion="맑음">
          <div class="emotion-icon">☀️</div>
          <div class="emotion-label">맑음</div>
        </div>
        <div class="emotion-item" data-emotion="구름조금">
          <div class="emotion-icon">⛅</div>
          <div class="emotion-label">구름조금</div>
        </div>
        <div class="emotion-item" data-emotion="흐림">
          <div class="emotion-icon">☁️</div>
          <div class="emotion-label">흐림</div>
        </div>
        <div class="emotion-item" data-emotion="비">
          <div class="emotion-icon">🌧️</div>
          <div class="emotion-label">비</div>
        </div>
        <div class="emotion-item" data-emotion="번개">
          <div class="emotion-icon">⚡</div>
          <div class="emotion-label">번개</div>
        </div>
        <div class="emotion-item" data-emotion="무지개">
          <div class="emotion-icon">🌈</div>
          <div class="emotion-label">무지개</div>
        </div>
        <div class="emotion-item" data-emotion="안개">
          <div class="emotion-icon">🌫️</div>
          <div class="emotion-label">안개</div>
        </div>
      </div>
    </div>

    <!-- 세부 감정 -->
    <div class="card" id="subEmotionCard" style="display: none;">
      <h2>💭 더 자세한 기분은?</h2>
      <div id="subEmotionContainer" class="sub-emotion-container">
        <!-- 세부 감정이 동적으로 추가됩니다 -->
      </div>
    </div>

    <!-- 일기 작성 -->
    <div class="card">
      <h2>✏️ 오늘의 일기</h2>
      <div class="form-group">
        <textarea id="diaryContent" placeholder="오늘은 어떤 일이 있었나요? 어떤 기분이었나요?"></textarea>
        <div class="input-options">
          <button class="icon-button" onclick="startVoiceInput()" title="음성 입력">🎤</button>
          <button class="icon-button" onclick="insertEmoji()" title="이모지 삽입">😊</button>
          <button class="icon-button" onclick="showWritingTips()" title="작성 도움말">💡</button>
        </div>
      </div>
    </div>

    <!-- 액션 버튼 -->
    <div class="action-buttons">
      <button class="btn btn-primary" onclick="saveDiary()">💾 저장하기</button>
      <button class="btn btn-success" onclick="sendToTeacher()">📨 선생님께 보내기</button>
      <button class="btn btn-info" onclick="loadMyDiaries()">📚 내 일기 보기</button>
      <button class="btn btn-secondary" onclick="saveAsImage()">📸 이미지로 저장</button>
      <button class="btn btn-warning" onclick="refreshPage()">🔄 새로 시작</button>
    </div>

    <!-- 내 일기 목록 -->
    <div class="card" id="myDiariesCard" style="display: none;">
      <h2>📖 내가 쓴 일기</h2>
      <div id="myDiariesContainer" class="diaries-container">
        <!-- 일기 목록이 동적으로 추가됩니다 -->
      </div>
    </div>

    <!-- 작성 팁 모달 -->
    <div id="writingTipsModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>✍️ 일기 작성 도움말</h3>
          <span class="close" onclick="closeWritingTips()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="tip-section">
            <h4>🌟 이런 것들을 써보세요:</h4>
            <ul>
              <li>오늘 가장 기억에 남는 일</li>
              <li>친구들과 함께한 재미있는 일</li>
              <li>새로 배운 것이나 느낀 점</li>
              <li>고마웠던 사람이나 일</li>
              <li>내일 하고 싶은 일</li>
            </ul>
          </div>
          <div class="tip-section">
            <h4>💝 감정 표현 도움말:</h4>
            <div class="emotion-tips">
              <div class="tip-item">☀️ <strong>맑음:</strong> 기쁘고 즐거운 마음</div>
              <div class="tip-item">⛅ <strong>구름조금:</strong> 평범하지만 괜찮은 기분</div>
              <div class="tip-item">☁️ <strong>흐림:</strong> 조금 우울하거나 지루한 기분</div>
              <div class="tip-item">🌧️ <strong>비:</strong> 슬프거나 속상한 마음</div>
              <div class="tip-item">⚡ <strong>번개:</strong> 화나거나 짜증나는 기분</div>
              <div class="tip-item">🌈 <strong>무지개:</strong> 특별하고 감동적인 마음</div>
              <div class="tip-item">🌫️ <strong>안개:</strong> 복잡하거나 헷갈리는 기분</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 로딩 오버레이 -->
  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="spinner"></div>
    <p>처리 중...</p>
  </div>

  <!-- 캔버스 (이미지 저장용) -->
  <canvas id="diaryCanvas" style="display: none;"></canvas>

  <!-- 서버 사이드 템플릿 변수들 -->
  <script>
    // Google Apps Script에서 전달된 파라미터들
    const pageParams = {
      newDiary: <?= typeof newDiary !== 'undefined' ? newDiary : false ?>,
      viewMyDiaries: <?= typeof viewMyDiaries !== 'undefined' ? viewMyDiaries : false ?>
    };
  </script>

  <?!= include('javascript'); ?>
</body>
</html>